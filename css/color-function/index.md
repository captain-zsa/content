---
title: "`color()`"
description: "Обеспечиваем поддержку p3-цветов и преобразуем один цвет в другой."
authors:
  - solarrust
related:
  - css/web-colors
  - css/color
  - css/mix-blend-mode
tags:
  - article
---

Новая CSS-функция `color()` позволяет по-новому указывать значение цвета. У неё два способа использования:

- _Абсолютный синтаксис_. Указание цвета в цветовой области, отличной от sRGB.
- _Относительный синтаксис_. Перевод цвета из одного цветового пространства в другое.

Можно использовать в качестве значения для любых свойств, где нужен цвет. Например, [`color`](/css/color/), [`border-color`](/css/border-color/) или [`accent-color`](/css/accent-color/).

## Абсолютный синтаксис

В CSS существует большое количество способов [обозначения цвета](/css/web-colors/). Способ обозначения цвета зависит от выбранного цветового пространства. Возможности работы с цветами эволюционируют, цветовых пространств становится всё больше. Пока не для каждого пространства существуют отдельные функции типа `rgb()` или `hsl()`. Некоторые цвета пока можно описать только при помощи `color()`.

Например, цвета из пространства Display P3 можно указать только через эту функцию. Так записывается аналог цвета `#00bbff`:

```css
.block {
  background-color: color(display-p3 0 0.72 1);
}
```

Если ваш монитор поддерживает пространство Display P3, то вы увидите разницу между левым и правым блоками. Левый ярче, насыщеннее.

<iframe title="Display P3" src="demos/display-p3/" height="400"></iframe>

### Параметры

Параметры функции `color()` при асбсолютном синтаксисе:

1. Цветовое пространство. Ключевое слово, обозначающее нужный спектр.
  - `srgb`;
  - `srgb-linear`;
  - `display-p3`;
  - `a98-rgb`;
  - `prophoto-rgb`;
  - `rec2020`;
  - `xyz`;
  - `xyz-d50`;
  - `xyz-d65`.
2. Компоненты цвета. Цвет, выраженный в трёх значениях.
3. Альфа-канал. Необязательное значение. Позволяет указать прозрачность цвета. Указывается через слэш `/`.

### Цветовые пространства и компоненты

Укажем цветовое пространство `a98-rgb` и компоненты цвета `0.29`, `0.73` и `1`.

```css
.block {
  background-color: color(a98-rgb 0.29 0.73 1);
}
```

Тот же цвет в пространстве `srgb-linear` с компонентами `0`, `0.5` и `1`.

```css
.block {
  background-color: color(srgb-linear 0 0.5 1);
}
```

### Альфа-канал

Добавим всем цветам альфа-канал со значением `0.5`, сделаем цвет полупрозрачным:

```css
.block-1 {
  background-color: color(display-p3 0 0.72 1 / 0.5);
}

.block-2 {
  background-color: color(a98-rgb 0.29 0.73 1 / 0.5);
}

.block-3 {
  background-color: color(srgb-linear 0 0.5 1 / 0.5);
}
```

<iframe title="Абсолютный синтаксис" src="demos/absolute/" height="400"></iframe>

## Относительный синтаксис

Относительный синтаксис используется для преобразования цвета, перевода его из одного цветового пространства в другое.

### Параметры

Параметры функции `color()`:

1. `from` + оригинальный цвет. При относительном синтаксисе обязательно писать ключевое слово и цвет, который хотим преобразовать.
2. Цветовое пространство. Ключевое слово, указывающее, в какое из цветовых пространств нужно перевести цвет.
  - `srgb`;
  - `srgb-linear`;
  - `display-p3`;
  - `a98-rgb`;
  - `prophoto-rgb`;
  - `rec2020`;
  - `xyz`;
  - `xyz-d50`;
  - `xyz-d65`.
3. Компоненты цвета. Три канала для обозначения цвета. Числовое или буквенное обозначение.
4. Альфа-канал. Необязательное значение. Позволяет указать прозрачность цвета. Указывается через слэш `/`.

### Цветовые пространства и компоненты

При относительном синтаксисе браузер раскладывает любой цвет минимум на три канала в выбранном цветовом пространстве. Если в каким-то из каналов не нужно производить вычисления, то можно указать его в виде буквы:

- `r`, `g` и `b`: для цветовых пространств `srgb`, `srgb-linear`, `display-p3`, `a98-rgb`, `prophoto-rgb` и `rec2020`.
- `x`, `y` и `z`: для цветовых пространств `xyz`, `xyz-d50` и `xyz-d65`.

Если в исходном цвете есть альфа-канал, то за него отвечает слово `alpha`.

### Перевод в другое цветовое пространство

Переведём цвет `seagreen` в цветовое пространство `display-p3` и добавим прозрачность `0.8`:

```css
.block {
  background-color: color(from seagreen display-p3 r g b / 0.8);
}
```

### Изменение компонентов цвета

Переведём тот же цвет в простанство `a98-rgb`, первый компонент `r` оставим неизменным, второй `g` заменим на 1, а третий `b` — на 0:

```css
.block {
  background-color: color(from seagreen a98-rgb r 1 0 / 0.8);
}
```

При желании можно заменить два, три или все четыре компонента цвета и получить совершенно новый цвет. Но тогда встаёт вопрос: зачем такие сложности?

### `calc()` для вычислений

Можно использовать функцию [`calc()`](/css/calc/) для вычислений внутри `color()`. Переведём всё тот же `seagreen` в пространство `xyz`, к каждому из компонентов прибавим по 0.3.

```css
.block {
  background-color: color(from seagreen xyz calc(x + 0.3) calc(y + 0.3) calc(z + 0.3));
}
```

При вычислениях важно использовать целые или дробные числа без единиц измерения. Если добавить `%`, `deg` или другие единицы, то вычисление сломается.

<iframe title="Относительный синтаксис" src="demos/relative/" height="400"></iframe>

## Пропущенный компонент

Вместо любого из компонентов цвета можно использовать ключевое слово `none`. Браузер при чтении подставит вместо него 0 с нужными единицами измерения.

Эти две записи приведут к одинаковым результатам:

```css
.block {
  color: color(display-p3 0 0.72 1 / 0.5)
  background-color: color(display-p3 none 0.72 1 / 0.5);
}
```

И в этом случае цвет получится одинаковым:

```css
.block {
  color: color(from hsl(none 100% 50%) srgb r g b / 0.8);
  background-color: color(from hsl(0deg 100% 50%) srgb r g b / 0.8);
}
```

## Использование кастомных свойств

Чаще всего в проектах набор цветов хранится в виде переменных. Внутри функции `color()` можно использовать [кастомные свойств](/css/custom-properties/).

Предположим, что есть набор из трёх цветов и нужно добавить каждому из них альфа-канал:

```css
:root {
  --text-color: white;
  --background-color: #191970;
  --accent-color: hsl(9 100% 63.9%);
}

.block {
  color: color(from var(--text-color) srgb r g b / 0.5);
  border: 1px solid color(from var(--accent-color) display-p3 r g b / 0.9);
  background-color: color(from var(--background-color) xyz x y z / 0.5);
}
```

<iframe title="Кастомные свойства" src="demos/custom-props/" height="400"></iframe>

## Проверка поддержки

Поскольку функция `color()` достаточно новая, всегда стоит помнить про браузеры, которые её не поддерживают. Проверяйте поддержку на [Can I use](https://caniuse.com/css-color-function).

### Прогрессивное улучшение

При помощи директивы [`@supports`](/css/supports/) можно проверить, поддерживает ли конкретный браузер новый синтаксис. И, если поддерживает, показать пользователю более яркие цвета:

```css
.block {
  color: seagreen;
}

@supports(color: color(display-p3 0.29 0.54 0.36)) {
  .block {
    color: color(display-p3 0.29 0.54 0.36);
  }
}
```

Можно использовать для проверки директиву [`@media`](/css/media/) с условием `color-gamut` для проверки поддержки цветового пространства:

```css
.block {
  color: seagreen;
}

@media (color-gamut: p3) {
  .block {
    color: color(display-p3 0.29 0.54 0.36);
  }
}
```

### Постепенная деградация

Можно пойти с другого конца и изначально всем показывать цвет, записанный через `color()`. А если синтаксис не поддерживается, то показывать цвет без `color()`.

```css
.block {
  color: seagreen;
  color: color(display-p3 0.29 0.54 0.36);
}
```

В примере выше, если браузер умеет читать `color()`, то применится второе правило, поскольку оно ниже по коду. А если прочитать его не выйдет, то браузер его откинет и применит стоящее выше правило с цветом `seagreen`.
